name: Compare Branches

on:
  workflow_dispatch:
    inputs:
      repositories:
        description: 'List of repositories to check (comma-separated)'
        required: true
        default: 'https://github.com/aakashdinkarh/portfolio-v1.git,https://github.com/aakashdinkarh/panda-img.git'

jobs:
  compare-branches:
    runs-on: ubuntu-latest
    
    steps:
      - name: Check branch differences
        run: |
          # Function to compare branches
          compare_branches() {
            local repo=$1
            echo "Checking repository: $repo"
            
            # Get commit hashes for both branches
            MASTER_HASH=$(git ls-remote $repo refs/heads/master | cut -f1)
            REMOTE_BUILD_HASH=$(git ls-remote $repo refs/heads/remote-build | cut -f1)
            
            # Check if remote-build branch exists
            if [ -z "$REMOTE_BUILD_HASH" ]; then
              echo "âŒ remote-build branch not found in $repo"
              return
            fi
            
            # Compare the hashes
            if [ "$MASTER_HASH" != "$REMOTE_BUILD_HASH" ]; then
              echo "âš ï¸ Changes found between master and remote-build in $repo"
              echo "$repo" >> $GITHUB_WORKSPACE/needs_update.txt
            else
              echo "âœ… No changes to compare in $repo"
            fi
          }
          
          # Create workspace directory if it doesn't exist
          mkdir -p $GITHUB_WORKSPACE
          
          # Convert comma-separated input to array
          IFS=',' read -ra REPOS <<< "${{ github.event.inputs.repositories }}"
          
          # Check each repository
          for repo in "${REPOS[@]}"; do
            compare_branches "$repo"
            echo "-----------------------------------"
          done
          
          # Show summary of repositories needing updates
          if [ -f "$GITHUB_WORKSPACE/needs_update.txt" ]; then
            echo "ðŸ“‹ Summary of repositories needing updates:"
            cat "$GITHUB_WORKSPACE/needs_update.txt"
          else
            echo "âœ… All repositories are in sync!"
          fi
